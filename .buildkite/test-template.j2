{% set docker_image = "us-central1-docker.pkg.dev/vllm-405802/vllm-ci-test-repo/vllm-test:$BUILDKITE_COMMIT" %}
{% set default_num_gpu = 1 %}
{% set default_working_dir = "/vllm-workspace/tests" %}

steps:
  - group: "AMD Tests"
    depends_on: ~
    steps:
      - label: "AMD Tests"
        agents:
          queue: amd
        commands:
        {% for step in steps %}
        {% if step.mirror_hardwares and "amd" in step.mirror_hardwares %} 
          - bash .buildkite/run-amd-test.sh "cd {{ (step.working_dir or default_working_dir) | safe  }} ; {{ step.command  or (step.commands | join(" ; ")) | safe }}"
        {% endif %}
        {% endfor %}
        env:
          DOCKER_BUILDKIT: "1"
        soft_fail: true